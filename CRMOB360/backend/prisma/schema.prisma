// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelos baseados no esquema de banco de dados definido

model usuarios {
  id                  String    @id @default(dbgenerated("gen_random_uuid()"))
  email               String    @unique @db.VarChar(255)
  senha_hash          String    @db.VarChar(255)
  nome                String    @db.VarChar(255)
  telefone            String?   @db.VarChar(20)
  tipo_usuario        String    @db.VarChar(50)
  ativo               Boolean   @default(true)
  avatar_url          String?
  created_at          DateTime  @default(now())
  updated_at          DateTime  @default(now()) @updatedAt
  ultimo_acesso       DateTime?
  config_notificacoes Json      @default("{}")

  // Relacionamentos
  clientes_responsavel      clientes[]      @relation("Responsavel")
  clientes_criado_por       clientes[]      @relation("CriadoPor")
  atividades_realizadas     atividades[]    @relation("AtividadeRealizada")
  imoveis_responsavel       imoveis[]       @relation("ImovelResponsavel")
  imoveis_criado_por        imoveis[]       @relation("ImovelCriadoPor")
  usuario_perfis            usuario_perfil[]
  
  @@map("usuarios")
}

model perfis_acesso {
  id          String   @id @default(dbgenerated("gen_random_uuid()"))
  nome        String   @db.VarChar(100)
  descricao   String?
  permissoes  Json
  created_at  DateTime @default(now())
  
  usuario_perfis usuario_perfil[]
  
  @@map("perfis_acesso")
}

model usuario_perfil {
  usuario_id String
  perfil_id  String
  
  usuario usuarios      @relation(fields: [usuario_id], references: [id])
  perfil  perfis_acesso @relation(fields: [perfil_id], references: [id])
  
  @@id([usuario_id, perfil_id])
  @@map("usuario_perfil")
}

model clientes {
  id              String    @id @default(dbgenerated("gen_random_uuid()"))
  nome            String    @db.VarChar(255)
  email           String?   @db.VarChar(255)
  telefone        String?   @db.VarChar(20)
  cpf_cnpj        String?   @db.VarChar(20)
  tipo_pessoa     String    @default("fisica") @db.VarChar(20)
  origem          String?   @db.VarChar(100)
  status_lead     String    @default("novo") @db.VarChar(50)
  score_ia        Int       @default(0)
  perfil_busca    Json      @default("{}")
  responsavel_id  String?
  criado_por      String?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt
  ultimo_contato  DateTime?
  tags            String[]
  custom_fields   Json      @default("{}")

  // Relacionamentos
  responsavel       usuarios?             @relation("Responsavel", fields: [responsavel_id], references: [id])
  criador           usuarios?             @relation("CriadoPor", fields: [criado_por], references: [id])
  atividades        atividades[]
  pipeline_leads    pipeline_leads[]
  imoveis_proprietario imoveis[]          @relation("Proprietario")
  contratos_locatario  contratos_locacao[] @relation("Locatario")
  contratos_fiador     contratos_locacao[] @relation("Fiador")
  propostas_cliente    propostas[]        @relation("PropostaCliente")
  contas_financeiras  contas_financeiras[]
  solicitacoes_lgpd   solicitacoes_lgpd[]
  
  @@map("clientes")
}

model funis_venda {
  id         String   @id @default(dbgenerated("gen_random_uuid()"))
  nome       String   @db.VarChar(255)
  descricao  String?
  tipo       String   @db.VarChar(50)
  etapas     Json
  ativo      Boolean  @default(true)
  created_at DateTime @default(now())
  
  pipeline_leads pipeline_leads[]
  
  @@map("funis_venda")
}

model pipeline_leads {
  id                  String    @id @default(dbgenerated("gen_random_uuid()"))
  cliente_id          String
  funil_id            String
  etapa_atual         String    @db.VarChar(100)
  valor_estimado      Decimal?  @db.Decimal(15, 2)
  data_entrada_etapa  DateTime  @default(now())
  previsao_fechamento DateTime? @db.Date
  responsavel_id      String?
  created_at          DateTime  @default(now())
  updated_at          DateTime  @default(now()) @updatedAt

  cliente     clientes      @relation(fields: [cliente_id], references: [id])
  funil       funis_venda   @relation(fields: [funil_id], references: [id])
  responsavel usuarios?     @relation(fields: [responsavel_id], references: [id])
  
  @@map("pipeline_leads")
}

model atividades {
  id               String    @id @default(dbgenerated("gen_random_uuid()"))
  cliente_id       String
  tipo             String    @db.VarChar(50)
  descricao        String
  data_hora        DateTime  @default(now())
  realizado_por    String?
  duracao_minutos  Int?
  resultado          String?   @db.VarChar(50)
  proxima_acao     DateTime? @db.Date
  anexos           Json      @default("[]")

  cliente      clientes @relation(fields: [cliente_id], references: [id])
  usuario      usuarios? @relation("AtividadeRealizada", fields: [realizado_por], references: [id])
  
  @@map("atividades")
}

model imoveis {
  id                   String    @id @default(dbgenerated("gen_random_uuid()"))
  codigo               String    @unique @db.VarChar(50)
  titulo               String    @db.VarChar(255)
  descricao            String?
  tipo_imovel          String    @db.VarChar(50)
  finalidade           String    @db.VarChar(20)
  status               String    @default("disponivel") @db.VarChar(50)
  proprietario_id      String?
  responsavel_id       String?
  cep                  String?   @db.VarChar(10)
  logradouro           String?   @db.VarChar(255)
  numero               String?   @db.VarChar(20)
  complemento          String?   @db.VarChar(255)
  bairro               String?   @db.VarChar(100)
  cidade               String?   @db.VarChar(100)
  uf                   String?   @db.VarChar(2)
  area_total           Decimal?  @db.Decimal(10, 2)
  area_util            Decimal?  @db.Decimal(10, 2)
  quartos              Int?
  suites               Int?
  banheiros            Int?
  vagas_garagem        Int?
  andar                Int?
  valor_venda          Decimal?  @db.Decimal(15, 2)
  valor_locacao        Decimal?  @db.Decimal(15, 2)
  valor_condominio     Decimal?  @db.Decimal(12, 2)
  valor_iptu           Decimal?  @db.Decimal(12, 2)
  publicado_site       Boolean   @default(false)
  publicado_portais    Json      @default("{}")
  fotos                Json      @default("[]")
  videos               Json      @default("[]")
  planta_baixa         String?
  visitas_count        Int       @default(0)
  criado_por           String?
  created_at           DateTime  @default(now())
  updated_at           DateTime  @default(now()) @updatedAt
  tags                 String[]
  custom_fields        Json      @default("{}")

  // Relacionamentos
  proprietario      clientes?              @relation("Proprietario", fields: [proprietario_id], references: [id])
  responsavel       usuarios?              @relation("ImovelResponsavel", fields: [responsavel_id], references: [id])
  criador           usuarios?              @relation("ImovelCriadoPor", fields: [criado_por], references: [id])
  chaves            imovel_chaves[]
  documentos        imovel_documentos[]
  contratos         contratos_locacao[]
  propostas         propostas[]
  contas_financeiras contas_financeiras[]
  
  @@map("imoveis")
}

model imovel_chaves {
  id                String    @id @default(dbgenerated("gen_random_uuid()"))
  imovel_id         String
  localizacao       String    @db.VarChar(255)
  status            String    @default("disponivel") @db.VarChar(50)
  emprestada_para   String?
  data_emprestimo   DateTime?
  data_devolucao    DateTime?
  created_at        DateTime  @default(now())

  imovel      imoveis  @relation(fields: [imovel_id], references: [id])
  usuario     usuarios? @relation(fields: [emprestada_para], references: [id])
  
  @@map("imovel_chaves")
}

model imovel_documentos {
  id                  String    @id @default(dbgenerated("gen_random_uuid()"))
  imovel_id           String
  tipo                String    @db.VarChar(100)
  arquivo_url         String
  nome_arquivo        String?   @db.VarChar(255)
  tamanho_bytes       BigInt?
  mime_type           String?   @db.VarChar(100)
  data_vencimento     DateTime? @db.Date
  alerta_vencimento_dias Int    @default(30)
  uploaded_por        String?
  created_at          DateTime  @default(now())

  imovel  imoveis  @relation(fields: [imovel_id], references: [id])
  usuario usuarios? @relation(fields: [uploaded_por], references: [id])
  
  @@map("imovel_documentos")
}

model contratos_locacao {
  id                      String    @id @default(dbgenerated("gen_random_uuid()"))
  numero_contrato         String    @unique @db.VarChar(50)
  imovel_id               String
  locatario_id            String
  fiador_id               String?
  data_inicio             DateTime  @db.Date
  data_fim                DateTime  @db.Date
  prorrogacao_automatica  Boolean   @default(true)
  valor_aluguel           Decimal   @db.Decimal(12, 2)
  valor_condominio        Decimal   @default(0) @db.Decimal(12, 2)
  dia_vencimento          Int
  taxa_administracao      Decimal   @default(10.0) @db.Decimal(5, 2)
  multa_atraso_percentual Decimal   @default(2.0) @db.Decimal(5, 2)
  juros_mora_percentual   Decimal   @default(0.033) @db.Decimal(5, 2)
  status                  String    @default("ativo") @db.VarChar(50)
  motivo_encerramento     String?
  data_encerramento       DateTime? @db.Date
  documento_url           String?
  assinado_digitalmente   Boolean   @default(false)
  created_at              DateTime  @default(now())
  updated_at              DateTime  @default(now()) @updatedAt

  imovel      imoveis @relation(fields: [imovel_id], references: [id])
  locatario   clientes @relation("Locatario", fields: [locatario_id], references: [id])
  fiador      clientes? @relation("Fiador", fields: [fiador_id], references: [id])
  contas_financeiras contas_financeiras[]
  
  @@map("contratos_locacao")
}

model propostas {
  id                    String    @id @default(dbgenerated("gen_random_uuid()"))
  numero_proposta       String    @unique @db.VarChar(50)
  tipo                  String    @db.VarChar(20)
  imovel_id             String
  cliente_id            String
  corretor_id           String?
  valor_proposta        Decimal   @db.Decimal(15, 2)
  valor_sinal           Decimal?  @db.Decimal(15, 2)
  condicoes             String?
  status                String    @default("pendente") @db.VarChar(50)
  data_resposta         DateTime? @db.Date
  motivo_recusa         String?
  documento_url         String?
  assinado_digitalmente Boolean   @default(false)
  created_at            DateTime  @default(now())
  updated_at            DateTime  @default(now()) @updatedAt

  imovel   imoveis @relation(fields: [imovel_id], references: [id])
  cliente  clientes @relation("PropostaCliente", fields: [cliente_id], references: [id])
  
  @@map("propostas")
}

model plano_contas {
  id          String   @id @default(dbgenerated("gen_random_uuid()"))
  codigo      String   @unique @db.VarChar(20)
  nome        String   @db.VarChar(255)
  tipo        String   @db.VarChar(20)
  categoria   String?  @db.VarChar(50)
  parent_id   String?
  ativo       Boolean  @default(true)
  created_at  DateTime @default(now())

  parent      plano_contas? @relation("PlanoContasParent", fields: [parent_id], references: [id])
  children    plano_contas[] @relation("PlanoContasParent")
  contas      contas_financeiras[]
  
  @@map("plano_contas")
}

model centros_custo {
  id          String   @id @default(dbgenerated("gen_random_uuid()"))
  codigo      String   @unique @db.VarChar(20)
  nome        String   @db.VarChar(255)
  descricao   String?
  ativo       Boolean  @default(true)
  created_at  DateTime @default(now())

  contas contas_financeiras[]
  
  @@map("centros_custo")
}

model contas_financeiras {
  id                  String    @id @default(dbgenerated("gen_random_uuid()"))
  numero_documento    String?   @db.VarChar(50)
  tipo                String    @db.VarChar(20)
  plano_conta_id      String
  centro_custo_id     String?
  descricao           String
  valor_original      Decimal   @db.Decimal(15, 2)
  valor_pago          Decimal   @default(0) @db.Decimal(15, 2)
  data_emissao        DateTime  @db.Date
  data_vencimento     DateTime  @db.Date
  data_pagamento      DateTime? @db.Date
  cliente_id          String?
  contrato_id         String?
  imovel_id           String?
  status              String    @default("pendente") @db.VarChar(50)
  gateway_pagamento   String?   @db.VarChar(50)
  boleto_url          String?
  boleto_codigo       String?   @db.VarChar(100)
  criado_por          String?
  created_at          DateTime  @default(now())
  updated_at          DateTime  @default(now()) @updatedAt

  plano_conta     plano_contas    @relation(fields: [plano_conta_id], references: [id])
  centro_custo    centros_custo?  @relation(fields: [centro_custo_id], references: [id])
  cliente         clientes?       @relation(fields: [cliente_id], references: [id])
  contrato        contratos_locacao? @relation(fields: [contrato_id], references: [id])
  imovel          imoveis?        @relation(fields: [imovel_id], references: [id])
  
  @@map("contas_financeiras")
}

model comissoes {
  id                     String    @id @default(dbgenerated("gen_random_uuid()"))
  numero_comissao        String    @unique @db.VarChar(50)
  tipo                   String    @db.VarChar(20)
  venda_id               String?
  locacao_id             String?
  corretor_vendedor_id   String?
  corretor_captador_id   String?
  gerente_id             String?
  valor_total            Decimal   @db.Decimal(15, 2)
  percentual_imobiliaria Decimal   @default(40.0) @db.Decimal(5, 2)
  percentual_vendedor    Decimal   @default(40.0) @db.Decimal(5, 2)
  percentual_captador    Decimal   @default(15.0) @db.Decimal(5, 2)
  percentual_gerente     Decimal   @default(5.0) @db.Decimal(5, 2)
  valor_imobiliaria      Decimal?  @db.Decimal(15, 2)
  valor_vendedor         Decimal?  @db.Decimal(15, 2)
  valor_captador         Decimal?  @db.Decimal(15, 2)
  valor_gerente          Decimal?  @db.Decimal(15, 2)
  status                 String    @default("calculada") @db.VarChar(50)
  data_pagamento         DateTime? @db.Date
  calculada_por          String?
  created_at             DateTime  @default(now())
  updated_at             DateTime  @default(now()) @updatedAt

  @@map("comissoes")
}

model log_consentimento_lgpd {
  id_log                    String    @id @default(dbgenerated("gen_random_uuid()"))
  id_cliente                String
  timestamp_consentimento   DateTime  @db.Timestamptz()
  texto_consentimento_hash  String    @db.VarChar(64)
  id_template_termo         String?
  ip_origem                 String?
  canal_origem              String?   @db.VarChar(100)
  permissao_email_mkt       Boolean   @default(false)
  permissao_whatsapp_mkt    Boolean   @default(false)
  permissao_ia_perfil       Boolean   @default(false)

  cliente clientes @relation(fields: [id_cliente], references: [id])
  
  @@map("log_consentimento_lgpd")
}

model templates_termos {
  id              String    @id @default(dbgenerated("gen_random_uuid()"))
  nome            String    @db.VarChar(255)
  tipo            String    @db.VarChar(50)
  versao          Int       @default(1)
  texto_conteudo  String
  ativo           Boolean   @default(true)
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt
  
  @@map("templates_termos")
}

model solicitacoes_lgpd {
  id                String    @id @default(dbgenerated("gen_random_uuid()"))
  cliente_id        String
  tipo_solicitacao  String    @db.VarChar(50)
  status            String    @default("pendente") @db.VarChar(50)
  motivo_negacao    String?
  data_atendimento  DateTime? @db.Date
  created_at        DateTime  @default(now())

  cliente clientes @relation(fields: [cliente_id], references: [id])
  
  @@map("solicitacoes_lgpd")
}

model templates_processo {
  id          String   @id @default(dbgenerated("gen_random_uuid()"))
  nome        String   @db.VarChar(255)
  descricao   String?
  tipo        String   @db.VarChar(50)
  etapas      Json
  gatilhos    Json      @default("[]")
  ativo       Boolean  @default(true)
  created_at  DateTime @default(now())

  processos processos[]
  
  @@map("templates_processo")
}

model processos {
  id              String    @id @default(dbgenerated("gen_random_uuid()"))
  template_id     String
  entidade_tipo   String    @db.VarChar(50)
  entidade_id     String
  status          String    @default("ativo") @db.VarChar(50)
  etapa_atual     String?   @db.VarChar(100)
  responsavel_id  String?
  data_inicio     DateTime  @default(now())
  data_conclusao  DateTime?

  template    templates_processo @relation(fields: [template_id], references: [id])
  responsavel usuarios?          @relation(fields: [responsavel_id], references: [id])
  tarefas     tarefas_processo[]
  
  @@map("processos")
}

model tarefas_processo {
  id              String    @id @default(dbgenerated("gen_random_uuid()"))
  processo_id     String
  titulo          String    @db.VarChar(255)
  descricao       String?
  atribuido_para  String?
  prazo           DateTime? @db.Date
  prioridade      String    @default("normal") @db.VarChar(20)
  status          String    @default("pendente") @db.VarChar(50)
  concluida_em    DateTime?
  anexos          Json      @default("[]")
  created_at      DateTime  @default(now())

  processo    processos @relation(fields: [processo_id], references: [id])
  atribuido   usuarios? @relation(fields: [atribuido_para], references: [id])
  
  @@map("tarefas_processo")
}

model configuracoes {
  id          String   @id @default(dbgenerated("gen_random_uuid()"))
  chave       String   @unique @db.VarChar(255)
  valor       Json
  descricao   String?
  categoria   String?  @db.VarChar(50)
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now()) @updatedAt
  
  @@map("configuracoes")
}